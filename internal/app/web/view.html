<title>Logserver View</title>
<head>
	<link href="data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBQAAFgAAACgAAAAQAAAAIAAAAAEACAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAADWsoACGtiADK9vwAGX01AIHW4wARgmQAqev1AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMFBwUHBQMHBQcFAwIDBQAAAAICBQcFBwUFAgUGAgAAAAAAAAYFBQUCBgUDBQYCAAAAAAIBAQYCAgYBBgICBgYEBAYGBgYGBgYGBgYGBgAAAAQBBgACAAIAAgACAAAAAAQGAgAAAAAAAAAAAAAAAAQGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAADgAQAA+AAAAPAAAAAAAQAAxVcAAI//AAA//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAA=" rel="icon" type="image/x-icon" />
	<!-- Doc: https://plotly.com/javascript/line-charts/pi -->
	<!-- Dark theme derived from: https://jsfiddle.net/3hfq7ast/ -->
	<!-- Load plotly.js into the DOM -->
	<script src='https://cdn.plot.ly/plotly-2.22.0.min.js'></script>
	<style>
		body {
			background-color: rgb(17,17,17) !important;
		}
	</style>
</head>

<body>
	<div id='temps'><!-- Plotly chart will be drawn inside this DIV --></div>
	<div id='light_heat'><!-- Plotly chart will be drawn inside this DIV --></div>

<script src="/web/chart_tpl.min.js" type="text/javascript"></script>
<script>

let template = templateDark;
var tempsDiv = document.getElementById('temps');
var lightheatDiv = document.getElementById('light_heat');

async function getData(module) {
    let url = '/viewData/'+module;
    try {
        let resp = await fetch(url);
        return await resp.json();
    } catch (error) {
        console.log(error);
    }
}

async function loadCave() {
	let data = await getData("cave");

	// check if there temp data
	if (data["temp"] == null) {
		return;
	}

	for (var key in data["temp"]) {
		data["temp"][key] = parseFloat(data["temp"][key]);
		// leave only 2 decimal places
		data["temp"][key] = Math.round(data["temp"][key] * 100) / 100;
	}

	var temp = {
		x: Object.keys(data["temp"]),
		y: Object.values(data["temp"]),
		type: 'scatter',
		name: 'Temp ˚C'
	};

	var MainLayout = {
		yaxis: {
			title: 'Temp ˚C', 
			gridcolor: 'rgba(99, 110, 250, 0.2)'
		},
		margin: {"t": 32, "b": 0, "l": 0, "r": 180},
		height: 400,
		template: template
	}
	plots = [temp];

	// check if there targetTemp data
	if (data["targetTemp"] != null) {

		for (var key in data["targetTemp"]) {
			data["targetTemp"][key] = parseInt(data["targetTemp"][key]);
		}

		var targetTemp = {
			x: Object.keys(data["targetTemp"]),
			y: Object.values(data["targetTemp"]),
			type: 'scatter',
			name: 'Target Temp ˚C',
		};
		MainLayout.yaxis2 = {
			title: 'Target Temp ˚C',
			overlaying: 'y',
			side: 'right',
			gridcolor: 'rgba(239, 85, 59, 0.2)',
			showgrid: false,
		}
		plots.push(targetTemp);
	}
	Plotly.newPlot(tempsDiv, plots, MainLayout);


	lightheatplot = [];
	var LightHeatLayout = {
		yaxis: {
			title: 'Heater',
			side: 'left',
			showgrid: false,
		},
		margin: {"t": 32, "b": 0, "l": 16, "r": 180},
		height: 200,
		template: template
	}
	// check if there targetTemp data
	if (data["heater"] != null) {
	
		for (var key in data["heater"]) {
			data["heater"][key] = parseFloat(data["heater"][key]);
			// leave only 2 decimal places
			data["heater"][key] = Math.round(data["heater"][key] * 100) / 100;
		}
		var heater = {
			x: Object.keys(data["heater"]),
			y: Object.values(data["heater"]),
			type: 'scatter',
			name: 'Heater',
			yaxis: 'y',
		};
		lightheatplot.push(heater);
	}

	// check if there light data
	if (data["light"] != null) {

		for (var key in data["light"]) {
			data["light"][key] = parseInt(data["light"][key]);
		}

		var light = {
			x: Object.keys(data["light"]),
			y: Object.values(data["light"]),
			type: 'scatter',
			name: 'Light',
			yaxis: 'y2',
		};
		LightHeatLayout.yaxis2 = {
			title: 'Light',
			overlaying: 'y',
			side: 'right',
			gridcolor: 'rgba(239, 85, 59, 0.2)',
			showgrid: false,
		}
		lightheatplot.push(light);
	}
	Plotly.newPlot(lightheatDiv, lightheatplot, LightHeatLayout);

	tempsDiv.on('plotly_relayout', function(eventdata){
		Plotly.relayout(lightheatDiv, eventdata);
	});

}

async function loadCharts() {
	await loadCave();
}

var interval = setInterval(loadCharts, 60000);

loadCharts();

</script>
</body>