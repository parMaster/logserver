<title>RPId View</title>
<head>
	<link href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbAAACnAUBJ98BAASnAAAAIwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAABxAAAC5DIEvf9FBP3/NwTP/wIACukAAAByAAAACgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABACAAm/IQKH/w4BSv8LAUP/HwKF/xMCWf8MAUX/IwKN/wMAF9EAAAAhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGALAOt/0wF//8eAn3/HAJ6/zoE2P8kA5T/HgJ//0sE//81BMj/AQAEpwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0j8E6v81BMv/BQEn/0ME9v9CBPX/RwT//xMCWv82BM3/RwT//wMBFN4AAAAAAAAAAAAAAAAAAAAAAAAARw4CSf8OAkz/AwEX/wUBJP8rA6b/QgT0/zMDxP8FAST/BQEp/x4CgP8LAUT9AAAAQwAAAAAAAAAAAAAAAAAAAaA9BOL/CgE//ykDo/9CBPX/JgOa/wUBKf8bAnP/PgTn/ywDrf8IATf/OwTc/wAAAZ0AAAAAAAAAAAAAAAAAAAGCMQO8/x0Cev8+BOT/QgTz/0ME+f8JATr/PATe/0IE9v9ABO7/IgOL/zMEw/8AAAGHAAAAAAAAAAAAAAAAAAAAFQMAFdMFASn/IwKO/0YE//88BOD/BAEd/zYEzf9HBP//KwOn/woBO/8EAR/aAAAAGwAAAAAAAAAAAAAAAAAAAAAAAABrJgOb/xsCdv8QAk//GgJw/xsCdf8hA4b/FgJl/yECh/8lA5j/AAAAZwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGwcANN83AM//DgBH/y8Ct/9LBP//OAPU/xQAWv81AMr/BgAt3gAAABYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQC2AFEy/wRmTP8EBh7/DwBP/wQCHf8DWkX/AF81/wAEAMsAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB/AHA2/wDIWP8AulD/AFId/wAGAP8APAv/AK9M/wDJWf8AjEL/AQMCrQAAAAAAAAAAAAAAAAAAAAAAAAAKAR8K6QDCXP8Aq1H/AJBF/wC6V/8ANRf/ALBQ/wCVRP8Ao0z/AMle/wBAHf8AAAAkAAAAAAAAAAAAAAAAAAAAGAEkDv8AoEv/AKlQ/wCvUf8AdDb/AAIBvwBcKf8ArFD/AKtR/wClT/8AQR7/AAAAPAAAAAAAAAAAAAAAAAAAAAIAAABSAQICngISBtMBBwS6AAAAbwAAAAQAAABXAQQDsQITB9MBBAOrAAAAZAAAAAkAAAAA/j8AAPwfAADwBwAA4AMAAOADAADgAwAAwAEAAMABAADgAwAA8AcAAPAHAADwBwAA8AMAAOADAADgAwAA8ccAAA==" rel="icon" type="image/x-icon" />
	<!-- Doc: https://plotly.com/javascript/line-charts/pi -->
	<!-- Dark theme derived from: https://jsfiddle.net/3hfq7ast/ -->
	<!-- Load plotly.js into the DOM -->
	<script src='https://cdn.plot.ly/plotly-2.20.0.min.js'></script>
	<style>
		body {
			background-color: rgb(17,17,17) !important;
		}
	</style>
</head>

<body>
	<div id='temps'><!-- Plotly chart will be drawn inside this DIV --></div>
	<div id='light'><!-- Plotly chart will be drawn inside this DIV --></div>

<script src="/web/chart_tpl.min.js" type="text/javascript"></script>
<script>

let template = templateDark;

async function getData(module) {
    let url = '/viewData/'+module;
    try {
        let resp = await fetch(url);
        return await resp.json();
    } catch (error) {
        console.log(error);
    }
}

async function loadCave() {
	let data = await getData("cave");

	// check if there temp data
	if (data["temp"] == null) {
		return;
	}

	for (var key in data["temp"]) {
		data["temp"][key] = parseFloat(data["temp"][key]);
		// leave only 2 decimal places
		data["temp"][key] = Math.round(data["temp"][key] * 100) / 100;
	}

	var temp = {
		x: Object.keys(data["temp"]),
		y: Object.values(data["temp"]),
		type: 'scatter',
		name: 'Temp ˚C'
	};

	var MainLayout = {
		yaxis: {
			title: 'Temp ˚C', 
			gridcolor: 'rgba(99, 110, 250, 0.2)'
		},
		margin: {"t": 32, "b": 0, "l": 0, "r": 0},
		height: 400,
		template: template
	}
	plots = [temp];

	// check if there targetTemp data
	if (data["targetTemp"] != null) {

		for (var key in data["targetTemp"]) {
			data["targetTemp"][key] = parseInt(data["targetTemp"][key]);
		}

		var targetTemp = {
			x: Object.keys(data["targetTemp"]),
			y: Object.values(data["targetTemp"]),
			type: 'scatter',
			name: 'Target Temp ˚C',
		};
		MainLayout.yaxis2 = {
			title: 'Target Temp ˚C',
			overlaying: 'y',
			side: 'right',
			gridcolor: 'rgba(239, 85, 59, 0.2)',
			showgrid: false,
		}
		plots.push(targetTemp);	
	}
	Plotly.newPlot('temps', plots, MainLayout);


	// check if there light data
	if (data["light"] != null) {

		for (var key in data["light"]) {
			data["light"][key] = parseInt(data["light"][key]);
		}

		var light = {
			x: Object.keys(data["light"]),
			y: Object.values(data["light"]),
			type: 'scatter',
			name: 'Light',
			yaxis: 'y2',
		};
		MainLayout.yaxis2 = {
			title: 'Light',
			overlaying: 'y',
			side: 'right',
			gridcolor: 'rgba(239, 85, 59, 0.2)',
			showgrid: false,
		}

		// Plotly.newPlot('light', [light], MainLayout);
	}


}

async function loadCharts() {
	await loadCave();
}

var interval = setInterval(loadCharts, 60000);

loadCharts();

</script>
</body>